# Prometheus Helm values
server:
  global:
    scrape_interval: 15s
    evaluation_interval: 15s

  # Prometheus scrape configs
  extraScrapeConfigs: |
    scrape_configs:
      # --- Prometheus self ---
      - job_name: 'prometheus'
        static_configs:
          - targets: ['prometheus-server.metrics.svc.cluster.local:80']

      # --- Kube-State-Metrics ---
      - job_name: 'kube-state-metrics'
        static_configs:
          - targets: ['kube-state-metrics.metrics.svc.cluster.local:8080']

      # --- Kubernetes API Server ---
      - job_name: 'kube-apiserver'
        kubernetes_sd_configs:
          - role: endpoints
        relabel_configs:
          - source_labels: [__meta_kubernetes_service_name]
            regex: 'kube-apiserver'
            action: keep

      # --- Controller Manager ---
      - job_name: 'kube-controller-manager'
        kubernetes_sd_configs:
          - role: endpoints
        relabel_configs:
          - source_labels: [__meta_kubernetes_service_name]
            regex: 'kube-controller-manager'
            action: keep

      # --- Scheduler ---
      - job_name: 'kube-scheduler'
        kubernetes_sd_configs:
          - role: endpoints
        relabel_configs:
          - source_labels: [__meta_kubernetes_service_name]
            regex: 'kube-scheduler'
            action: keep

      # --- Kubelet Metrics (nodes only) ---
      - job_name: 'kubelet'
        kubernetes_sd_configs:
          - role: node
        scheme: https
        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
        tls_config:
          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
          insecure_skip_verify: true
        metrics_path: /metrics
        relabel_configs:
          - source_labels: [__meta_kubernetes_node_name]
            target_label: kubernetes_node

  # Persistent volume for Prometheus data
  persistence:
    enabled: true
    storageClass: standard
    accessModes: ["ReadWriteOnce"]
    size: 5Gi

  # Resources
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 1
      memory: 2Gi

  # Service type
  service:
    type: NodePort
    nodePort: 30090
    port: 9090

  # RBAC
  serviceAccount:
    create: true
    name: prometheus
  rbac:
    create: true